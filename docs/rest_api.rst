
REST API documentation
======================

``grano`` exposes most of it's functionality via a web-based programming interface.
The interface communicates mostly using JSON data, and exposes a set of resources, 
such as projects, schemata, entities, and relations.

Before using this API, it is advisable to read the :ref:`techintro`.

.. contents::
    :backlinks: none
    :local:

Authentication
--------------

Read access to all of ``granos`` functionality is provided without restriction 
or the need for authentication. For write operations, such as creating and editing
datasets and entities, a user will have to provide either a valid session cookie, 
generated by using OAuth against `GitHub <https://github.com>`_, or an 
API key. The API key is available in the user profile page for users which have
logged in.

The API key must be submitted with each request, and it can either be given as the
``api_key`` query parameter, or as the value of the ``Authorization``
request header. When an API key is given, ``grano`` still performs authorization 
checks and return an HTTP 401 error when the credentials are invalid, or an HTTP
403 error, when the user tries to modify objects which he is not authorized to 
write.


Sessions
++++++++

In order to determine if the (browser-based) user has a valid session, ``grano`` 
provides an API which returns details of the current user. The API is available
at::

    GET /api/1/sessions

This will contain a flag to indicate a user is logged in, the serialized account
data if an account is available, and the user's API key. 

An OAuth-based login can be triggered by pointing the user agent at this endpoint::

    GET /api/1/sessions/login

If the query argument ``next_url`` is provided, the user is forwarded to the 
given URL upon completion (successful or not) of the OAuth request.

Inversely, the current session can be erased by visiting this endpoint::

    GET /api/1/sessions/logout

The query argument ``next_url`` is available and has the same semantics as during
login.


Cross-origin requests
---------------------

All API responses can be encoded as JSON with padding (JSON-P) by adding a ``callback``
argument to the request. This will allow remote script inclusion to load data into a 
web site on a different domain. Cross-origin request sharing (CORS) is not currently 
supported.


.. _pager:

Pagination
----------

All collections of HTTP resources such as datasets or entities provide a similar 
interface that supports pagination by means of limit and offset. A paginated 
response will be a JSON object with the following properties:

* ``results`` is an ordered list of the available HTTP resources, often serialized
  in an abridged (shallow) form to reduce the response size.
* ``count`` gives the overall number of available results, including all available
  pages.
* ``limit`` and ``offset`` give the current state of the pager, indicating the
  number of results that will be returned with each request and the number of
  results to be skipped before returning results, respectively.
* ``next`` and ``previous`` are two URLs that can be used to retrieve the next or
  previous page of results. Both properties can be ``null`` when either no further
  pages are available or the query returned the first page of the result set. Both
  URLs are also returned in the ``Link`` headers of the HTTP response.

Any pager can be modified using the following query parameters:

* ``limit`` sets a limit to the number of resources returned. An maximum of 1000
  resources is enforced, the default is to return 50 resources if no limit has 
  been provided explicitly.
* ``offset`` instructs the pager to skip the given number of initial records before
  beginning to return resources.


Domain resources
----------------

Grano exposes a set of public (REST) resources via its API. They are listed at the
root of the API::

    GET /api/1 

This root endpoint will also list the current version of ``grano``, as well as a 
link to the most recent verson of this documentation. 


Projects
++++++++

::

    GET /api/1/projects

Retrieves a collection of all projects that are currently available on grano.
Standard :ref:`pager` arguments are available.

::

    GET /api/1/projects/<slug>

Retrieves a single project from the API, including all its settings.


Schemata
++++++++

::

    GET /api/1/schemata

Retrieves a collection of all schemata that are currently available on grano.
Standard :ref:`pager` arguments are available.

::

    GET /api/1/schemata/<name>

Retrieves a single schema from the API, including all attributes.


Entities
++++++++

::

    GET /api/1/entities

Retrieves a collection of all entities that are currently available on grano.
Standard :ref:`pager` arguments are available.

::

    GET /api/1/entities/<id>

Retrieves a single entity from the API, including all its properties and references
to the schemata that apply.


Relations
+++++++++

::

    GET /api/1/relations

Retrieves a collection of all relations that are currently available on grano.
Standard :ref:`pager` arguments are available.

::

    GET /api/1/relations/<id>

Retrieves a single relation from the API, including all its properties and references
to the schema as well as the source and target entities.

